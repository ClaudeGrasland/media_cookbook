[["22-mediacloud_to_quanteda.html", "Chapter 3 Creation of a quanteda corpus 3.1 Example 3.2 Germany", " Chapter 3 Creation of a quanteda corpus library(quanteda) Package version: 3.0.0 Unicode version: 13.0 ICU version: 69.1 Parallel computing: 8 of 8 threads used. See https://quanteda.io for tutorials and examples. library(dplyr) library(ggplot2) library(tidytext) library(knitr) library(readtext) knitr::opts_chunk$set(cache = TRUE, echo = TRUE, comment = &quot;&quot;) In the previous section (ref…) whe have obtained a .csv file of news collected from MediaCloud. We will try now to put this data in a standard form and we have chosen the format of the quanteda package as reference for data organization and storage. But of course the researchers involved in the project can prefer to use other R packages like tm or tidytext. And they can also prefer to use another programming language for Python. It is the reason why we explain how to transform and export the data that has been prepared and harmonized with quanteda in various format like .csv or JSON. 3.1 Example We detail here an example of importation with the example of the newspaper “L’économiste maghrebin” 3.1.1 Importation of text to R This step is not always obvious because many problems of encoding can appear that are more or less easy to solve. In principle , the data from Media Cloud are exported in standard UTF-8 but as we will see it is not necessary the case. We try firstly to use the standard R function read.csv(): store &lt;- &quot;corpus/TUN/&quot; media &lt;- &quot;fr_TUN_ecomag&quot; type &lt;-&quot;.csv&quot; fic &lt;- paste(store,media,type,sep=&quot;&quot;) df&lt;-read.csv(fic, sep=&quot;,&quot;, header=T, encoding = &quot;UTF-8&quot;, stringsAsFactors = F) head(df) stories_id publish_date 1 1129295780 2019-01-02 03:42:46 2 1129295771 2019-01-02 04:06:27 3 1129295760 2019-01-02 06:05:08 4 1129578051 2019-01-02 10:05:06 5 1129461662 2019-01-02 07:52:36 6 1129461636 2019-01-02 08:57:54 title 1 Les tarifs de l&amp;#8217;ADSL réduits à partir du 1er janvier 2019 2 6ème Sfax Marathon International des Oliviers 3 Télécharger la version finale de la Loi de finances 2019 4 Chawki Tabib : 245 dossiers de corruption présumée transmis au ministère public 5 Panoro Energy finalise l&amp;#8217;acquisition de OMV Tunisia 6 La partie syndicale maintient le boycott des examens du secondaire url 1 https://www.leconomistemaghrebin.com/2019/01/02/tarifs-adsl-reduits-1-janvier-2019/ 2 https://www.leconomistemaghrebin.com/2019/01/02/sfax-marathon-international-oliviers/ 3 https://www.leconomistemaghrebin.com/2019/01/02/telecharger-la-version-finale-de-la-loi-de-finances-2019/ 4 https://www.leconomistemaghrebin.com/2019/01/02/chawki-tabib-245-dossiers-transferes-au-ministere-public/ 5 https://www.leconomistemaghrebin.com/2019/01/02/panoro-energy-finalise-lacquisition-de-omv-tunisia/ 6 https://www.leconomistemaghrebin.com/2019/01/02/partie-syndicale-boycott-examens-secondaire/ language ap_syndicated themes media_id media_name 1 fr False 623820 L&#39;Economiste Maghrebin 2 fr False 623820 L&#39;Economiste Maghrebin 3 en False 623820 L&#39;Economiste Maghrebin 4 fr False 623820 L&#39;Economiste Maghrebin 5 fr False 623820 L&#39;Economiste Maghrebin 6 fr False 623820 L&#39;Economiste Maghrebin media_url 1 http://www.leconomistemaghrebin.com/ 2 http://www.leconomistemaghrebin.com/ 3 http://www.leconomistemaghrebin.com/ 4 http://www.leconomistemaghrebin.com/ 5 http://www.leconomistemaghrebin.com/ 6 http://www.leconomistemaghrebin.com/ str(df) &#39;data.frame&#39;: 12794 obs. of 10 variables: $ stories_id : int 1129295780 1129295771 1129295760 1129578051 1129461662 1129461636 1130259352 1131673651 1132241460 1132432991 ... $ publish_date : chr &quot;2019-01-02 03:42:46&quot; &quot;2019-01-02 04:06:27&quot; &quot;2019-01-02 06:05:08&quot; &quot;2019-01-02 10:05:06&quot; ... $ title : chr &quot;Les tarifs de l&amp;#8217;ADSL réduits à partir du 1er janvier 2019&quot; &quot;6ème Sfax Marathon International des Oliviers&quot; &quot;Télécharger la version finale de la Loi de finances 2019&quot; &quot;Chawki Tabib : 245 dossiers de corruption présumée transmis au ministère public&quot; ... $ url : chr &quot;https://www.leconomistemaghrebin.com/2019/01/02/tarifs-adsl-reduits-1-janvier-2019/&quot; &quot;https://www.leconomistemaghrebin.com/2019/01/02/sfax-marathon-international-oliviers/&quot; &quot;https://www.leconomistemaghrebin.com/2019/01/02/telecharger-la-version-finale-de-la-loi-de-finances-2019/&quot; &quot;https://www.leconomistemaghrebin.com/2019/01/02/chawki-tabib-245-dossiers-transferes-au-ministere-public/&quot; ... $ language : chr &quot;fr&quot; &quot;fr&quot; &quot;en&quot; &quot;fr&quot; ... $ ap_syndicated: chr &quot;False&quot; &quot;False&quot; &quot;False&quot; &quot;False&quot; ... $ themes : chr &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ... $ media_id : int 623820 623820 623820 623820 623820 623820 623820 623820 623820 623820 ... $ media_name : chr &quot;L&#39;Economiste Maghrebin&quot; &quot;L&#39;Economiste Maghrebin&quot; &quot;L&#39;Economiste Maghrebin&quot; &quot;L&#39;Economiste Maghrebin&quot; ... $ media_url : chr &quot;http://www.leconomistemaghrebin.com/&quot; &quot;http://www.leconomistemaghrebin.com/&quot; &quot;http://www.leconomistemaghrebin.com/&quot; &quot;http://www.leconomistemaghrebin.com/&quot; ... The importation was successfull for 13623 news but message of errors appeared for 3 news where R sent a message of error telling : Error in gregexpr(calltext, singleline, fixed = TRUE) : regular expression is invalid UTF-8 Looking in more details, we discover also some problems of encoding in news like in the following example where the text of the news appears differently if we apply the standard functions paste() o0 the specialized function r knitr::kable for printing. paste(df[9, 3]) [1] &quot;Néji Jalloul : &amp;#8220;Nidaa Tounes peut revenir si&amp;#8230;&amp;#8221;&quot; kable((df[9,3])) x Néji Jalloul : “Nidaa Tounes peut revenir si…” 3.1.2 encoding problems It is sometime possible to adapt manually the encoding problem whan they are not too much as in present example. df$text&lt;-df$title # standardize apostrophe df$text&lt;-gsub(&quot;&amp;#8217;&quot;,&quot;&#39;&quot;,df$text) # standardize punct df$text&lt;-gsub(&#39;&amp;#8230;&#39;,&#39;.&#39;,df$text) # standardize hyphens df$text&lt;-gsub(&#39;&amp;#8211;&#39;,&#39;-&#39;,df$text) # Remove quotation marks df$text&lt;-gsub(&#39;&amp;#171;&amp;#160;&#39;,&#39;&#39;,df$text) df$text&lt;-gsub(&#39;&amp;#160;&amp;#187;&#39;,&#39;&#39;,df$text) df$text&lt;-gsub(&#39;&amp;#8220;&#39;,&#39;&#39;,df$text) df$text&lt;-gsub(&#39;&amp;#8221;&#39;,&#39;&#39;,df$text) df$text&lt;-gsub(&#39;&amp;#8216;&#39;,&#39;&#39;,df$text) df$text&lt;-gsub(&#39;&amp;#8243;&#39;,&#39;&#39;,df$text) We can introduce othr cleaning procedures here or keep it for later analysis 3.1.3 Transformation in quanteda format We propose a storage based on quanteda format by just transforming the data that has been produced by readtext. We keep only the name of the source and the date of publication. # Create Quanteda corpus qd&lt;-corpus(df,docid_field = &quot;stories_id&quot;) # Select docvar fields and rename media qd$date &lt;-as.Date(qd$publish_date) qd$source &lt;-media docvars(qd)&lt;-docvars(qd)[,c(&quot;source&quot;,&quot;date&quot;)] # Add global meta meta(qd,&quot;meta_source&quot;)&lt;-&quot;Media Cloud &quot; meta(qd,&quot;meta_time&quot;)&lt;-&quot;Download the 2021-09-30&quot; meta(qd,&quot;meta_author&quot;)&lt;-&quot;Elaborated by Claude Grasland&quot; meta(qd,&quot;project&quot;)&lt;-&quot;ANR-DFG Project IMAGEUN&quot; We have created a quanteda object with a lot of information stored in various fields. The structure of the object is the following one str(qd) &#39;corpus&#39; Named chr [1:12794] &quot;Les tarifs de l&#39;ADSL réduits à partir du 1er janvier 2019&quot; ... - attr(*, &quot;names&quot;)= chr [1:12794] &quot;1129295780&quot; &quot;1129295771&quot; &quot;1129295760&quot; &quot;1129578051&quot; ... - attr(*, &quot;docvars&quot;)=&#39;data.frame&#39;: 12794 obs. of 5 variables: ..$ docname_: chr [1:12794] &quot;1129295780&quot; &quot;1129295771&quot; &quot;1129295760&quot; &quot;1129578051&quot; ... ..$ docid_ : Factor w/ 12794 levels &quot;1129295780&quot;,&quot;1129295771&quot;,..: 1 2 3 4 5 6 7 8 9 10 ... ..$ segid_ : int [1:12794] 1 1 1 1 1 1 1 1 1 1 ... ..$ source : chr [1:12794] &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; ... ..$ date : Date[1:12794], format: &quot;2019-01-02&quot; &quot;2019-01-02&quot; ... - attr(*, &quot;meta&quot;)=List of 3 ..$ system:List of 6 .. ..$ package-version:Classes &#39;package_version&#39;, &#39;numeric_version&#39; hidden list of 1 .. .. ..$ : int [1:3] 3 0 0 .. ..$ r-version :Classes &#39;R_system_version&#39;, &#39;package_version&#39;, &#39;numeric_version&#39; hidden list of 1 .. .. ..$ : int [1:3] 4 0 2 .. ..$ system : Named chr [1:3] &quot;Darwin&quot; &quot;x86_64&quot; &quot;claudegrasland1&quot; .. .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;sysname&quot; &quot;machine&quot; &quot;user&quot; .. ..$ directory : chr &quot;/Users/claudegrasland1/git/media_cookbook&quot; .. ..$ created : Date[1:1], format: &quot;2021-10-02&quot; .. ..$ source : chr &quot;data.frame&quot; ..$ object:List of 2 .. ..$ unit : chr &quot;documents&quot; .. ..$ summary:List of 2 .. .. ..$ hash: chr(0) .. .. ..$ data: NULL ..$ user :List of 4 .. ..$ meta_source: chr &quot;Media Cloud &quot; .. ..$ meta_time : chr &quot;Download the 2021-09-30&quot; .. ..$ meta_author: chr &quot;Elaborated by Claude Grasland&quot; .. ..$ project : chr &quot;ANR-DFG Project IMAGEUN&quot; We can look at the first titles with head() kable(head(qd,3)) x 1129295780 Les tarifs de l’ADSL réduits à partir du 1er janvier 2019 1129295771 6ème Sfax Marathon International des Oliviers 1129295760 Télécharger la version finale de la Loi de finances 2019 We can get meta information on each stories with summary() summary(head(qd,3)) Corpus consisting of 3 documents, showing 3 documents: Text Types Tokens Sentences source date 1129295780 11 11 1 fr_TUN_ecomag 2019-01-02 1129295771 6 6 1 fr_TUN_ecomag 2019-01-02 1129295760 8 10 1 fr_TUN_ecomag 2019-01-02 We can get meta information about the full document meta(qd) $meta_source [1] &quot;Media Cloud &quot; $meta_time [1] &quot;Download the 2021-09-30&quot; $meta_author [1] &quot;Elaborated by Claude Grasland&quot; $project [1] &quot;ANR-DFG Project IMAGEUN&quot; 3.1.4 Storage of the quanteda object We can finally save the object in .RDS format in a directory dedicated to our quanteda files. It can be usefull to give some information in the name of the file store &lt;- &quot;quanteda/&quot; type&lt;- &quot;.RDS&quot; myfile &lt;- paste(store,media,type,sep=&quot;&quot;) myfile [1] &quot;quanteda/fr_TUN_ecomag.RDS&quot; saveRDS(qd,myfile) qd[1:3] Corpus consisting of 3 documents and 2 docvars. 1129295780 : &quot;Les tarifs de l&#39;ADSL réduits à partir du 1er janvier 2019&quot; 1129295771 : &quot;6ème Sfax Marathon International des Oliviers&quot; 1129295760 : &quot;Télécharger la version finale de la Loi de finances 2019&quot; summary(qd,3) Corpus consisting of 12794 documents, showing 3 documents: Text Types Tokens Sentences source date 1129295780 11 11 1 fr_TUN_ecomag 2019-01-02 1129295771 6 6 1 fr_TUN_ecomag 2019-01-02 1129295760 8 10 1 fr_TUN_ecomag 2019-01-02 We have kept all the information present in the initial file, but also added specific metadata of interest for us. The size of the storage is now equal to 0.6 Mb which means a division by 6 as compared to the initial .csv file downloaded from Media Cloud. 3.1.5 Backtransformation of quanteda to data.table or tibble In the following steps, we will make an intensive use of quanteda, but sometimes it can be usefull to export the results in a more practical format or to use other packages. For this reasons, it is important to know that the tidytextpackage can easily transform quanteda object in tibbles which are more classical and easy to manage td &lt;- tidy(qd) Warning: &#39;texts.corpus&#39; is deprecated. Use &#39;as.character&#39; instead. See help(&quot;Deprecated&quot;) head(td) # A tibble: 6 × 3 text source date &lt;chr&gt; &lt;chr&gt; &lt;date&gt; 1 Les tarifs de l&#39;ADSL réduits à partir du 1er janvier 20… fr_TUN_ec… 2019-01-02 2 6ème Sfax Marathon International des Oliviers fr_TUN_ec… 2019-01-02 3 Télécharger la version finale de la Loi de finances 2019 fr_TUN_ec… 2019-01-02 4 Chawki Tabib : 245 dossiers de corruption présumée tran… fr_TUN_ec… 2019-01-02 5 Panoro Energy finalise l&#39;acquisition de OMV Tunisia fr_TUN_ec… 2019-01-02 6 La partie syndicale maintient le boycott des examens du… fr_TUN_ec… 2019-01-02 str(td) tibble [12,794 × 3] (S3: tbl_df/tbl/data.frame) $ text : chr [1:12794] &quot;Les tarifs de l&#39;ADSL réduits à partir du 1er janvier 2019&quot; &quot;6ème Sfax Marathon International des Oliviers&quot; &quot;Télécharger la version finale de la Loi de finances 2019&quot; &quot;Chawki Tabib : 245 dossiers de corruption présumée transmis au ministère public&quot; ... $ source: chr [1:12794] &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; ... $ date : Date[1:12794], format: &quot;2019-01-02&quot; &quot;2019-01-02&quot; ... 3.2 Germany 3.2.1 Frankfurter Allgemeine Zeitung qd&lt;-readRDS(&quot;quanteda/de_DEU_frankf.RDS&quot;) paste(qd[1:5]) [1] &quot;Bundestagswahl: Durchmarsch der AfD&quot; [2] &quot;Kahl folgt auf Schindler: CSU kritisiert Wechsel an BND-Spitze&quot; [3] &quot;Dramatisches Ende einer Bergtour: Drei Deutsche nach eisiger Nacht in Tiroler Alpen gerettet&quot; [4] &quot;Trotz Gelbwesten-Protesten: Macron kündigt für 2019 weitere Reformen an&quot; [5] &quot;May wirbt in Neujahrsansprache für Brexit-Abkommen&quot; summary(qd,3) Corpus consisting of 88313 documents, showing 3 documents: Text Types Tokens Sentences source date 930016745 5 5 1 de_DEU_frankf 2020-09-06 1118202030 10 10 1 de_DEU_frankf 2021-07-06 1128764967 14 14 1 de_DEU_frankf 2019-01-01 3.2.2 Süddeutsche Zeitung qd&lt;-readRDS(&quot;quanteda/de_DEU_suddeu.RDS&quot;) paste(qd[1:5]) [1] &quot;EU setzt Russland Ultimatum&quot; [2] &quot;Flüchtlinge : Großbritannien verlegt Schiffe in den Ärmelkanal&quot; [3] &quot;Zugang zum Internet : Buena Vista Netz Club&quot; [4] &quot;Brasilien: Bolsonaros Plan&quot; [5] &quot;Dirty Dancing: Getanzter Dreck&quot; summary(qd,5) Corpus consisting of 35444 documents, showing 5 documents: Text Types Tokens Sentences source date 931884497 4 4 1 de_DEU_suddeu 2019-06-17 1128842071 8 8 1 de_DEU_suddeu 2019-01-01 1128842047 8 8 1 de_DEU_suddeu 2019-01-01 1128842007 4 4 1 de_DEU_suddeu 2019-01-01 1128842024 5 5 1 de_DEU_suddeu 2019-01-01 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
