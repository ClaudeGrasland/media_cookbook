[["30-Hypercube.html", "Chapter 7 Hypercube 7.1 Objectives 7.2 Prepare data 7.3 Geographical entities", " Chapter 7 Hypercube library(knitr) library(dplyr) library(quanteda) library(data.table) library(tidytext) library(FactoMineR) library(Factoshiny) library(explor) 7.1 Objectives We have created a list of tags relate to world regions for news published in 14 newspapers. We propose now to build an hypercube in order to explore the results. 7.2 Prepare data 7.2.1 Load corpus qd&lt;-readRDS(&quot;quanteda/corpus_worldgeo_V2.RDS&quot;) 7.2.2 Load hypercube function hypercube &lt;-function(qd = qd, when = &quot;date&quot;, when_cut = &quot;year&quot;, who = &quot;source&quot;, where1 = &quot;tags&quot;, where2 = &quot;tags&quot;) { # create data.table accroding to parameter chosen don&lt;-docvars(qd) df&lt;-data.table(id = docid(qd), who = don[,who], when = as.character(cut(don[,when],breaks=when_cut)), where1 = don[,where1], where2 = don[,where2]) # add code _no_ for empty fields df$where1[df$where1==&quot;&quot;]&lt;-&quot;_no_&quot; df$where2[df$where2==&quot;&quot;]&lt;-&quot;_no_&quot; # unnest where1 df&lt;-unnest_tokens(df,where1,where1,to_lower=F) # unnest where2 df&lt;-unnest_tokens(df,where2,where2,to_lower=F) # define number of occurence by id nb&lt;-df[,.N,list(id)] %&gt;% mutate(wgt = 1/N) %&gt;% select(-N) df&lt;-df %&gt;% left_join(nb) rm(nb) # Aggregate hc&lt;- df[,.( tags = .N, news=sum(wgt)) ,.(who, when,where1,where2)] # Convert date to time hc$when&lt;-as.Date(hc$when) # return hypercube return(hc) } 7.2.3 Create Hypercube hc_reg &lt;- hypercube(qd = qd, when = &quot;date&quot;, when_cut = &quot;months&quot;, who = &quot;source&quot;, where1 = &quot;tags&quot;, where2 = &quot;tags&quot;) Joining, by = &quot;id&quot; kable(head(hc_reg)) who when where1 where2 tags news fr_FRA_figaro 2019-01-01 no no 2502 2502.00 fr_FRA_figaro 2019-01-01 CA_JPN CA_JPN 6 5.25 fr_FRA_figaro 2019-01-01 ST_THA ST_THA 8 6.50 fr_FRA_figaro 2019-01-01 ST_COD ST_COD 1 1.00 fr_FRA_figaro 2019-01-01 ST_QAT ST_QAT 3 3.00 fr_FRA_figaro 2019-01-01 ST_GAB ST_GAB 5 5.00 7.2.4 Load Wikidata entity names reg_def&lt;-readRDS(&quot;dict/worldgeo_def_V1.RDS&quot;) # Choose language tab_def&lt;-reg_def %&gt;% filter(lang == &quot;fr&quot;) kable(head(tab_def)) id lang label type code Q15 fr Afrique cont CO_AFR Q828 fr Amérique cont CO_AMR Q48 fr Asie cont CO_ASI Q46 fr Europe cont CO_EUR Q538 fr Océanie cont CO_OCE Q51 fr Antarctique cont CO_ANT 7.3 Geographical entities 7.3.1 Which % of news ? What is the percentage of news where at less one geographical entity is mentioned ? hc_reg$tagged&lt;-hc_reg$where1!=&quot;_no_&quot; df&lt;-hc_reg[,list(nb = sum(news)), list(who, tagged)] %&gt;% dcast(formula = who~tagged, value.var = &quot;nb&quot;) names(df)&lt;-c(&quot;media&quot;,&quot;No&quot;, &quot;Yes&quot;) df$Tot = df$No+df$Yes df$Pct = 100*df$Yes/df$Tot df&lt;-df[order(df$Pct)] kable(df, digits=2) media No Yes Tot Pct ar_DZA_elkahb 49250 7586 56836 13.35 tr_TUR_cumhur 111953 19496 131449 14.83 de_DEU_frankf 74470 13601 88071 15.44 en_NIR_beltel 83348 15712 99060 15.86 ar_DZA_alnaha 28965 6187 35152 17.60 en_IRL_irtime 86991 19762 106753 18.51 de_DEU_suddeu 28287 7110 35397 20.09 en_GBR_telegr 30222 7682 37904 20.27 tr_TUR_yenisa 74609 21562 96171 22.42 en_GBR_guardi 59444 17602 77046 22.85 fr_FRA_figaro 92125 36164 128289 28.19 fr_FRA_lmonde 33779 15776 49555 31.84 7.3.2 Which entities are the most mentionned ? Iw we put together all newspapers, we obtain the following table # Compute df&lt;-hc_reg[where1 !=&quot;_no_&quot;,list(nb = sum(news)), list(where1)] # df&lt;-as.data.frame(df) df&lt;-merge(tab_def,df,by.x=&quot;code&quot;,by.y=&quot;where1&quot;,all.x=F,all.y=T) df&lt;-df[order(df$nb, decreasing = T),] row.names(df)&lt;-1:dim(df)[1] kable(head(df,30), digits=0,row.names = T) code id lang label type nb 1 ST_IRL Q27 fr Irlande sta 12130 2 ST_USA Q30 fr États-Unis sta 11944 3 ST_FRA Q142 fr France sta 10070 4 ST_TUR Q43 fr Turquie sta 8567 5 OR_EU Q458 fr Union européenne org 6278 6 ST_CHN Q148 fr République populaire de Chine sta 6150 7 CA_FRA Q90 fr Paris cap 5396 8 ST_DEU Q183 fr Allemagne sta 4956 9 CO_EUR Q46 fr Europe cont 4723 10 CA_IRL Q1761 fr Dublin cap 3959 11 ST_RUS Q159 fr Russie sta 3712 12 ST_ITA Q38 fr Italie sta 3656 13 ST_ISR Q801 fr Israël sta 3276 14 ST_DZA Q262 fr Algérie sta 3134 15 ST_IRN Q794 fr Iran sta 3116 16 ST_GBR Q145 fr Royaume-Uni sta 2976 17 CA_GBR Q84 fr Londres cap 2717 18 ST_IND Q668 fr Inde sta 2483 19 CA_DZA Q3561 fr Alger cap 2450 20 ST_ESP Q29 fr Espagne sta 2365 21 ST_AFG Q889 fr Afghanistan sta 2361 22 ST_AUS Q408 fr Australie sta 2279 23 CA_JPN Q1490 fr Tokyo cap 2189 24 ST_SYR Q858 fr Syrie sta 1848 25 ST_JPN Q17 fr Japon sta 1835 26 ST_GRC Q41 fr Grèce sta 1809 27 CA_TUR Q3640 fr Ankara cap 1771 28 ST_BRA Q155 fr Brésil sta 1767 29 CA_ESP Q2807 fr Madrid cap 1647 30 CA_DEU Q64 fr Berlin cap 1554 7.3.3 Top non state entities by media # Compute df&lt;-hc_reg[where1 !=&quot;_no_&quot;,list(nb = sum(news)), list(where1, who)] %&gt;% group_by(who) %&gt;% filter((substr(where1,1,2) %in% c(&quot;CA&quot;,&quot;ST&quot;))==FALSE) %&gt;% mutate(pct = 100*nb/sum(nb), rnk = rank(-nb)) df&lt;-merge(tab_def,df,by.x=&quot;code&quot;,by.y=&quot;where1&quot;,all.x=F,all.y=T) res &lt;- df %&gt;% filter(rnk &lt; 11) %&gt;% select(who, rnk,label, pct) %&gt;% mutate(who=substr(who,4,12)) res&lt;-res[order(res$who, res$rnk),] kable(res,digits=c(0,1)) who rnk label pct 81 DEU_frank 1.0 Union européenne 47.7 43 DEU_frank 2.0 Europe 26.5 97 DEU_frank 3.0 Organisation du traité de l’Atlantique Nord 4.9 7 DEU_frank 4.0 Afrique 3.5 113 DEU_frank 5.0 mer Méditerranée 1.9 29 DEU_frank 6.0 Asie 1.9 49 DEU_frank 7.0 Alpes 1.5 59 DEU_frank 8.0 Moyen-Orient 1.5 13 DEU_frank 9.0 Afrique australe 1.4 48 DEU_frank 10.0 Europe médiane 0.9 83 DEU_sudde 1.0 Union européenne 51.6 42 DEU_sudde 2.0 Europe 21.7 6 DEU_sudde 3.0 Afrique 3.8 63 DEU_sudde 4.0 Moyen-Orient 3.7 96 DEU_sudde 5.0 Organisation du traité de l’Atlantique Nord 3.4 115 DEU_sudde 6.0 mer Méditerranée 2.6 53 DEU_sudde 7.0 Alpes 2.3 20 DEU_sudde 8.0 Amérique du Sud 1.0 66 DEU_sudde 9.5 Proche-Orient 0.9 102 DEU_sudde 9.5 Arctique 0.9 11 DZA_alnah 1.0 Afrique 39.5 38 DZA_alnah 2.0 Europe 28.7 78 DZA_alnah 3.0 Union européenne 11.0 31 DZA_alnah 4.0 Asie 3.8 70 DZA_alnah 5.0 Sahel 3.5 61 DZA_alnah 6.0 Moyen-Orient 2.6 75 DZA_alnah 7.0 Ligue arabe 2.3 112 DZA_alnah 8.0 mer Méditerranée 1.9 67 DZA_alnah 9.0 Machrek 1.3 54 DZA_alnah 10.0 Amazonie 1.2 3 DZA_elkah 1.0 Afrique 54.6 36 DZA_elkah 2.0 Europe 20.8 84 DZA_elkah 3.0 Union européenne 7.3 119 DZA_elkah 4.0 mer Méditerranée 3.7 23 DZA_elkah 5.0 Asie 2.8 62 DZA_elkah 6.0 Moyen-Orient 2.6 71 DZA_elkah 7.0 Sahel 1.8 68 DZA_elkah 8.0 Machrek 1.8 74 DZA_elkah 9.0 Ligue arabe 1.2 104 DZA_elkah 10.0 océan Atlantique 0.7 47 FRA_figar 1.0 Europe 31.7 82 FRA_figar 2.0 Union européenne 27.0 110 FRA_figar 3.0 mer Méditerranée 3.9 9 FRA_figar 4.0 Afrique 3.8 52 FRA_figar 5.0 Alpes 3.7 55 FRA_figar 6.0 Amazonie 2.8 69 FRA_figar 7.0 Sahel 2.6 15 FRA_figar 8.0 Amérique 2.6 98 FRA_figar 9.0 Organisation du traité de l’Atlantique Nord 2.3 120 FRA_figar 10.0 Polynésie 2.0 45 FRA_lmond 1.0 Europe 30.8 87 FRA_lmond 2.0 Union européenne 19.5 5 FRA_lmond 3.0 Afrique 13.5 72 FRA_lmond 4.0 Sahel 4.3 51 FRA_lmond 5.0 Alpes 3.6 118 FRA_lmond 6.0 mer Méditerranée 3.5 56 FRA_lmond 7.0 Amazonie 1.9 91 FRA_lmond 8.0 Organisation du traité de l’Atlantique Nord 1.8 16 FRA_lmond 9.0 Amérique latine 1.7 60 FRA_lmond 10.0 Moyen-Orient 1.7 86 GBR_guard 1.0 Union européenne 41.2 44 GBR_guard 2.0 Europe 23.8 8 GBR_guard 3.0 Afrique 6.4 101 GBR_guard 4.0 Arctique 4.6 64 GBR_guard 5.0 Moyen-Orient 4.1 95 GBR_guard 6.0 Organisation du traité de l’Atlantique Nord 2.5 27 GBR_guard 7.0 Asie 1.7 19 GBR_guard 8.0 Amérique latine 1.7 22 GBR_guard 9.0 Antarctique 1.7 109 GBR_guard 10.0 Caraïbes 1.4 85 GBR_teleg 1.0 Union européenne 49.6 39 GBR_teleg 2.0 Europe 26.3 4 GBR_teleg 3.0 Afrique 7.6 30 GBR_teleg 4.0 Asie 2.5 103 GBR_teleg 5.0 Arctique 1.5 65 GBR_teleg 6.0 Moyen-Orient 1.3 76 GBR_teleg 7.5 Commonwealth 1.1 107 GBR_teleg 7.5 Caraïbes 1.1 17 GBR_teleg 9.0 Amérique latine 0.9 73 GBR_teleg 10.0 Sahel 0.9 89 IRL_irtim 1.0 Union européenne 65.2 46 IRL_irtim 2.0 Europe 21.0 1 IRL_irtim 3.0 Afrique 2.1 24 IRL_irtim 4.0 Asie 1.5 99 IRL_irtim 5.0 Organisation du traité de l’Atlantique Nord 1.2 58 IRL_irtim 6.0 Moyen-Orient 1.1 116 IRL_irtim 7.0 mer Méditerranée 0.9 18 IRL_irtim 8.0 Amérique latine 0.6 50 IRL_irtim 9.5 Alpes 0.6 90 IRL_irtim 9.5 marché commun du Sud 0.6 79 NIR_belte 1.0 Union européenne 63.6 37 NIR_belte 2.0 Europe 20.4 2 NIR_belte 3.0 Afrique 2.6 100 NIR_belte 4.0 Arctique 1.9 77 NIR_belte 5.0 Commonwealth 1.8 57 NIR_belte 6.0 Moyen-Orient 1.5 25 NIR_belte 7.0 Asie 1.4 108 NIR_belte 8.0 Caraïbes 1.2 94 NIR_belte 9.0 Organisation du traité de l’Atlantique Nord 1.1 114 NIR_belte 10.0 mer Méditerranée 0.5 40 TUR_cumhu 1.0 Europe 32.6 88 TUR_cumhu 2.0 Union européenne 18.3 33 TUR_cumhu 3.0 Asie mineure 13.4 111 TUR_cumhu 4.0 mer Méditerranée 9.3 105 TUR_cumhu 5.0 mer Noire 7.1 93 TUR_cumhu 6.0 Organisation du traité de l’Atlantique Nord 6.0 10 TUR_cumhu 7.0 Afrique 2.5 26 TUR_cumhu 8.0 Asie 2.0 34 TUR_cumhu 9.0 Eurasie 1.5 14 TUR_cumhu 10.0 Afrique australe 1.2 41 TUR_yenis 1.0 Europe 25.5 80 TUR_yenis 2.0 Union européenne 19.3 117 TUR_yenis 3.0 mer Méditerranée 13.3 106 TUR_yenis 4.0 mer Noire 11.8 32 TUR_yenis 5.0 Asie mineure 8.4 92 TUR_yenis 6.0 Organisation du traité de l’Atlantique Nord 7.0 12 TUR_yenis 7.0 Afrique 4.4 35 TUR_yenis 8.0 Eurasie 1.6 28 TUR_yenis 9.0 Asie 1.5 21 TUR_yenis 10.0 Antarctique 1.0 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
