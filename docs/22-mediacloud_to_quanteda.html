<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Creation of a quanteda corpus | The media cookbook</title>
  <meta name="description" content="A reminder of some experiments made in 2021" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Creation of a quanteda corpus | The media cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A reminder of some experiments made in 2021" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Creation of a quanteda corpus | The media cookbook" />
  
  <meta name="twitter:description" content="A reminder of some experiments made in 2021" />
  

<meta name="author" content="Claude Grasland" />


<meta name="date" content="2021-09-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="21-corpus-mediacloud.html"/>
<link rel="next" href="31_geonetworks.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">The Media Cookbook  <em>C. Grasland (2021)</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="21-corpus-mediacloud.html"><a href="21-corpus-mediacloud.html"><i class="fa fa-check"></i><b>2</b> Extraction of data from Media Cloud</a>
<ul>
<li class="chapter" data-level="2.1" data-path="21-corpus-mediacloud.html"><a href="21-corpus-mediacloud.html#selection-of-media-with-source-manager"><i class="fa fa-check"></i><b>2.1</b> Selection of media with source manager</a></li>
<li class="chapter" data-level="2.2" data-path="21-corpus-mediacloud.html"><a href="21-corpus-mediacloud.html#checking-the-stability-through-time"><i class="fa fa-check"></i><b>2.2</b> Checking the stability through time</a></li>
<li class="chapter" data-level="2.3" data-path="21-corpus-mediacloud.html"><a href="21-corpus-mediacloud.html#selection-of-news-specifically-related-to-a-topic-option"><i class="fa fa-check"></i><b>2.3</b> Selection of news specifically related to a topic (option)</a></li>
<li class="chapter" data-level="2.4" data-path="21-corpus-mediacloud.html"><a href="21-corpus-mediacloud.html#download-and-storage-of-news"><i class="fa fa-check"></i><b>2.4</b> Download and storage of news</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html"><i class="fa fa-check"></i><b>3</b> Creation of a quanteda corpus</a>
<ul>
<li class="chapter" data-level="3.1" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#importation-of-text-to-r"><i class="fa fa-check"></i><b>3.1</b> Importation of text to R</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#import-with-r-base"><i class="fa fa-check"></i><b>3.1.1</b> Import with R-Base</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#cleaning-of-the-text"><i class="fa fa-check"></i><b>3.2</b> Cleaning of the text</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#encoding-problems"><i class="fa fa-check"></i><b>3.2.1</b> encoding problems</a></li>
<li class="chapter" data-level="3.2.2" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#other-cleaning-actions"><i class="fa fa-check"></i><b>3.2.2</b> Other cleaning actions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#transformation-in-quanteda-format"><i class="fa fa-check"></i><b>3.3</b> Transformation in quanteda format</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#storage-of-the-quanteda-object"><i class="fa fa-check"></i><b>3.3.1</b> Storage of the quanteda object</a></li>
<li class="chapter" data-level="3.3.2" data-path="22-mediacloud_to_quanteda.html"><a href="22-mediacloud_to_quanteda.html#backtransformation-of-quanteda-to-data.table-or-tibble"><i class="fa fa-check"></i><b>3.3.2</b> Backtransformation of quanteda to data.table or tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="31_geonetworks.html"><a href="31_geonetworks.html"><i class="fa fa-check"></i><b>4</b> Geonetworks</a>
<ul>
<li class="chapter" data-level="4.1" data-path="31_geonetworks.html"><a href="31_geonetworks.html#geotags"><i class="fa fa-check"></i><b>4.1</b> Geotags</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="31_geonetworks.html"><a href="31_geonetworks.html#select-corpus"><i class="fa fa-check"></i><b>4.1.1</b> Select corpus</a></li>
<li class="chapter" data-level="4.1.2" data-path="31_geonetworks.html"><a href="31_geonetworks.html#tokenize"><i class="fa fa-check"></i><b>4.1.2</b> Tokenize</a></li>
<li class="chapter" data-level="4.1.3" data-path="31_geonetworks.html"><a href="31_geonetworks.html#identify-geotags"><i class="fa fa-check"></i><b>4.1.3</b> identify geotags</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="31_geonetworks.html"><a href="31_geonetworks.html#hypercubes"><i class="fa fa-check"></i><b>4.2</b> Hypercubes</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="31_geonetworks.html"><a href="31_geonetworks.html#load-data"><i class="fa fa-check"></i><b>4.2.1</b> Load data</a></li>
<li class="chapter" data-level="4.2.2" data-path="31_geonetworks.html"><a href="31_geonetworks.html#hypercube-function"><i class="fa fa-check"></i><b>4.2.2</b> Hypercube Function</a></li>
<li class="chapter" data-level="4.2.3" data-path="31_geonetworks.html"><a href="31_geonetworks.html#build-hypercube"><i class="fa fa-check"></i><b>4.2.3</b> Build hypercube</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="31_geonetworks.html"><a href="31_geonetworks.html#linkages"><i class="fa fa-check"></i><b>4.3</b> Linkages</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="31_geonetworks.html"><a href="31_geonetworks.html#select-links"><i class="fa fa-check"></i><b>4.3.1</b> Select links</a></li>
<li class="chapter" data-level="4.3.2" data-path="31_geonetworks.html"><a href="31_geonetworks.html#create-interaction-matrix"><i class="fa fa-check"></i><b>4.3.2</b> Create interaction matrix</a></li>
<li class="chapter" data-level="4.3.3" data-path="31_geonetworks.html"><a href="31_geonetworks.html#estimate-random-model"><i class="fa fa-check"></i><b>4.3.3</b> Estimate random model</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="31_geonetworks.html"><a href="31_geonetworks.html#visualization"><i class="fa fa-check"></i><b>4.4</b> Visualization</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="31_geonetworks.html"><a href="31_geonetworks.html#function"><i class="fa fa-check"></i><b>4.4.1</b> Function</a></li>
<li class="chapter" data-level="4.4.2" data-path="31_geonetworks.html"><a href="31_geonetworks.html#raw-network"><i class="fa fa-check"></i><b>4.4.2</b> Raw network</a></li>
<li class="chapter" data-level="4.4.3" data-path="31_geonetworks.html"><a href="31_geonetworks.html#raw-network-without-tunisia"><i class="fa fa-check"></i><b>4.4.3</b> Raw network without Tunisia</a></li>
<li class="chapter" data-level="4.4.4" data-path="31_geonetworks.html"><a href="31_geonetworks.html#preferential-links"><i class="fa fa-check"></i><b>4.4.4</b> Preferential links</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The media cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c22_mediacloud_to_quanteda" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Creation of a quanteda corpus</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="22-mediacloud_to_quanteda.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb2-2"><a href="22-mediacloud_to_quanteda.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="22-mediacloud_to_quanteda.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-4"><a href="22-mediacloud_to_quanteda.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb2-5"><a href="22-mediacloud_to_quanteda.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-6"><a href="22-mediacloud_to_quanteda.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readtext)</span>
<span id="cb2-7"><a href="22-mediacloud_to_quanteda.html#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="22-mediacloud_to_quanteda.html#cb2-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-9"><a href="22-mediacloud_to_quanteda.html#cb2-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-10"><a href="22-mediacloud_to_quanteda.html#cb2-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">comment =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>In the previous section (ref…) whe have obtained a .csv file of news collected from MediaCloud. We will try now to put this data in a standard form and we have chosen the format of the <code>quanteda</code> package as reference for data organization and storage.</p>
<p>But of course the researchers involved in the project can prefer to use other R packages like <code>tm</code> or <code>tidytext</code>. And they can also prefer to use another programming language for Python. It is the reason why we explain how to transform and export the data that has been prepared and harmonized with quanteda in various format like .csv or JSON.</p>
<div id="importation-of-text-to-r" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Importation of text to R</h2>
<p>This step is really not obvious because many problems of encoding can appear that are more or less easy to solve. In principle , the data from Media Cloud are exported in standard <code>UTF-8</code> but as we will see it is not necessary the case.</p>
<div id="import-with-r-base" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Import with R-Base</h3>
<p>We try firstly to use the standard R function <code>read.csv()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="22-mediacloud_to_quanteda.html#cb3-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="fu">url</span>(<span class="st">&quot;https://api.nakala.fr/data/10.34847/nkl.8e317m71/7d129d03a92e22b0af0a9fba0ca49703a89d7552&quot;</span>),</span>
<span id="cb3-2"><a href="22-mediacloud_to_quanteda.html#cb3-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep=</span><span class="st">&quot;,&quot;</span>,</span>
<span id="cb3-3"><a href="22-mediacloud_to_quanteda.html#cb3-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">header=</span>T,</span>
<span id="cb3-4"><a href="22-mediacloud_to_quanteda.html#cb3-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>,</span>
<span id="cb3-5"><a href="22-mediacloud_to_quanteda.html#cb3-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb3-6"><a href="22-mediacloud_to_quanteda.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre><code>  stories_id        publish_date
1 1129295780 2019-01-02 03:42:46
2 1129295771 2019-01-02 04:06:27
3 1129295760 2019-01-02 06:05:08
4 1129578051 2019-01-02 10:05:06
5 1129461662 2019-01-02 07:52:36
6 1129461636 2019-01-02 08:57:54
                                                                            title
1                 Les tarifs de l&amp;#8217;ADSL réduits à partir du 1er janvier 2019
2                                   6ème Sfax Marathon International des Oliviers
3                        Télécharger la version finale de la Loi de finances 2019
4 Chawki Tabib : 245 dossiers de corruption présumée transmis au ministère public
5                       Panoro Energy finalise l&amp;#8217;acquisition de OMV Tunisia
6              La partie syndicale maintient le boycott des examens du secondaire
                                                                                                        url
1                       https://www.leconomistemaghrebin.com/2019/01/02/tarifs-adsl-reduits-1-janvier-2019/
2                     https://www.leconomistemaghrebin.com/2019/01/02/sfax-marathon-international-oliviers/
3 https://www.leconomistemaghrebin.com/2019/01/02/telecharger-la-version-finale-de-la-loi-de-finances-2019/
4 https://www.leconomistemaghrebin.com/2019/01/02/chawki-tabib-245-dossiers-transferes-au-ministere-public/
5       https://www.leconomistemaghrebin.com/2019/01/02/panoro-energy-finalise-lacquisition-de-omv-tunisia/
6              https://www.leconomistemaghrebin.com/2019/01/02/partie-syndicale-boycott-examens-secondaire/
  language ap_syndicated themes media_id             media_name
1       fr         False          623820 L&#39;Economiste Maghrebin
2       fr         False          623820 L&#39;Economiste Maghrebin
3       en         False          623820 L&#39;Economiste Maghrebin
4       fr         False          623820 L&#39;Economiste Maghrebin
5       fr         False          623820 L&#39;Economiste Maghrebin
6       fr         False          623820 L&#39;Economiste Maghrebin
                             media_url
1 http://www.leconomistemaghrebin.com/
2 http://www.leconomistemaghrebin.com/
3 http://www.leconomistemaghrebin.com/
4 http://www.leconomistemaghrebin.com/
5 http://www.leconomistemaghrebin.com/
6 http://www.leconomistemaghrebin.com/</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="22-mediacloud_to_quanteda.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   12794 obs. of  10 variables:
 $ stories_id   : int  1129295780 1129295771 1129295760 1129578051 1129461662 1129461636 1130259352 1131673651 1132241460 1132432991 ...
 $ publish_date : chr  &quot;2019-01-02 03:42:46&quot; &quot;2019-01-02 04:06:27&quot; &quot;2019-01-02 06:05:08&quot; &quot;2019-01-02 10:05:06&quot; ...
 $ title        : chr  &quot;Les tarifs de l&amp;#8217;ADSL réduits à partir du 1er janvier 2019&quot; &quot;6ème Sfax Marathon International des Oliviers&quot; &quot;Télécharger la version finale de la Loi de finances 2019&quot; &quot;Chawki Tabib : 245 dossiers de corruption présumée transmis au ministère public&quot; ...
 $ url          : chr  &quot;https://www.leconomistemaghrebin.com/2019/01/02/tarifs-adsl-reduits-1-janvier-2019/&quot; &quot;https://www.leconomistemaghrebin.com/2019/01/02/sfax-marathon-international-oliviers/&quot; &quot;https://www.leconomistemaghrebin.com/2019/01/02/telecharger-la-version-finale-de-la-loi-de-finances-2019/&quot; &quot;https://www.leconomistemaghrebin.com/2019/01/02/chawki-tabib-245-dossiers-transferes-au-ministere-public/&quot; ...
 $ language     : chr  &quot;fr&quot; &quot;fr&quot; &quot;en&quot; &quot;fr&quot; ...
 $ ap_syndicated: chr  &quot;False&quot; &quot;False&quot; &quot;False&quot; &quot;False&quot; ...
 $ themes       : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
 $ media_id     : int  623820 623820 623820 623820 623820 623820 623820 623820 623820 623820 ...
 $ media_name   : chr  &quot;L&#39;Economiste Maghrebin&quot; &quot;L&#39;Economiste Maghrebin&quot; &quot;L&#39;Economiste Maghrebin&quot; &quot;L&#39;Economiste Maghrebin&quot; ...
 $ media_url    : chr  &quot;http://www.leconomistemaghrebin.com/&quot; &quot;http://www.leconomistemaghrebin.com/&quot; &quot;http://www.leconomistemaghrebin.com/&quot; &quot;http://www.leconomistemaghrebin.com/&quot; ...</code></pre>
<p>The importation was successfull for 13623 news but message of errors appeared for 3 news where R sent a message of error telling :</p>
<p><code>Error in gregexpr(calltext, singleline, fixed = TRUE) : regular expression is invalid UTF-8</code></p>
<p>Looking in more details, we discover also some problems of encoding in news like in the following example where the text of the news appears differently if we apply the standard functions <code>paste()</code> o0 the specialized function r <code>knitr::kable</code> for printing.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="22-mediacloud_to_quanteda.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(df[<span class="dv">9</span>, <span class="dv">3</span>])</span></code></pre></div>
<pre><code>[1] &quot;Néji Jalloul : &amp;#8220;Nidaa Tounes peut revenir si&amp;#8230;&amp;#8221;&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="22-mediacloud_to_quanteda.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>((df[<span class="dv">9</span>,<span class="dv">3</span>]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Néji Jalloul : “Nidaa Tounes peut revenir si…”</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cleaning-of-the-text" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Cleaning of the text</h2>
<p>in our opinion it is better to proceed to some cleaning operation before to import the text in quanteda and to create a news version of the initial .csv file.</p>
<div id="encoding-problems" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> encoding problems</h3>
<p>It is sometime possible to adapt manually the encoding problem whan they are not too much as in present example.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="22-mediacloud_to_quanteda.html#cb10-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span>df<span class="sc">$</span>title</span>
<span id="cb10-2"><a href="22-mediacloud_to_quanteda.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize apostrophe</span></span>
<span id="cb10-3"><a href="22-mediacloud_to_quanteda.html#cb10-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&quot;&amp;#8217;&quot;</span>,<span class="st">&quot;&#39;&quot;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-4"><a href="22-mediacloud_to_quanteda.html#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="22-mediacloud_to_quanteda.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize punct</span></span>
<span id="cb10-6"><a href="22-mediacloud_to_quanteda.html#cb10-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#8230;&#39;</span>,<span class="st">&#39;.&#39;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-7"><a href="22-mediacloud_to_quanteda.html#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="22-mediacloud_to_quanteda.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize hyphens</span></span>
<span id="cb10-9"><a href="22-mediacloud_to_quanteda.html#cb10-9" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#8211;&#39;</span>,<span class="st">&#39;-&#39;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-10"><a href="22-mediacloud_to_quanteda.html#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="22-mediacloud_to_quanteda.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove quotation marks</span></span>
<span id="cb10-12"><a href="22-mediacloud_to_quanteda.html#cb10-12" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#171;&amp;#160;&#39;</span>,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-13"><a href="22-mediacloud_to_quanteda.html#cb10-13" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#160;&amp;#187;&#39;</span>,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-14"><a href="22-mediacloud_to_quanteda.html#cb10-14" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#8220;&#39;</span>,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-15"><a href="22-mediacloud_to_quanteda.html#cb10-15" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#8221;&#39;</span>,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-16"><a href="22-mediacloud_to_quanteda.html#cb10-16" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#8216;&#39;</span>,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>text)</span>
<span id="cb10-17"><a href="22-mediacloud_to_quanteda.html#cb10-17" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>text<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;&amp;#8243;&#39;</span>,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>text)</span></code></pre></div>
</div>
<div id="other-cleaning-actions" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Other cleaning actions</h3>
<p>We can introduce othr cleaning procedures here or keep it for later analysis</p>
</div>
</div>
<div id="transformation-in-quanteda-format" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Transformation in quanteda format</h2>
<p>We propose a storage based on <code>quanteda</code> format by just transforming the data that has been produced by readtext. We keep only the name of the source and the date of publication.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="22-mediacloud_to_quanteda.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Quanteda corpus</span></span>
<span id="cb11-2"><a href="22-mediacloud_to_quanteda.html#cb11-2" aria-hidden="true" tabindex="-1"></a>qd<span class="ot">&lt;-</span><span class="fu">corpus</span>(df)</span>
<span id="cb11-3"><a href="22-mediacloud_to_quanteda.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="22-mediacloud_to_quanteda.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select docvar fields and rename media</span></span>
<span id="cb11-5"><a href="22-mediacloud_to_quanteda.html#cb11-5" aria-hidden="true" tabindex="-1"></a>qd<span class="sc">$</span>date <span class="ot">&lt;-</span><span class="fu">as.Date</span>(qd<span class="sc">$</span>publish_date)</span>
<span id="cb11-6"><a href="22-mediacloud_to_quanteda.html#cb11-6" aria-hidden="true" tabindex="-1"></a>qd<span class="sc">$</span>source <span class="ot">&lt;-</span><span class="st">&quot;fr_TUN_ecomag&quot;</span></span>
<span id="cb11-7"><a href="22-mediacloud_to_quanteda.html#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(qd)<span class="ot">&lt;-</span><span class="fu">docvars</span>(qd)[,<span class="fu">c</span>(<span class="st">&quot;source&quot;</span>,<span class="st">&quot;date&quot;</span>)]</span>
<span id="cb11-8"><a href="22-mediacloud_to_quanteda.html#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="22-mediacloud_to_quanteda.html#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="22-mediacloud_to_quanteda.html#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="22-mediacloud_to_quanteda.html#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="22-mediacloud_to_quanteda.html#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add global meta</span></span>
<span id="cb11-13"><a href="22-mediacloud_to_quanteda.html#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">meta</span>(qd,<span class="st">&quot;meta_source&quot;</span>)<span class="ot">&lt;-</span><span class="st">&quot;Media Cloud &quot;</span></span>
<span id="cb11-14"><a href="22-mediacloud_to_quanteda.html#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">meta</span>(qd,<span class="st">&quot;meta_time&quot;</span>)<span class="ot">&lt;-</span><span class="st">&quot;Download the 2021-07-13&quot;</span></span>
<span id="cb11-15"><a href="22-mediacloud_to_quanteda.html#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">meta</span>(qd,<span class="st">&quot;meta_author&quot;</span>)<span class="ot">&lt;-</span><span class="st">&quot;Elaborated by Claude Grasland&quot;</span></span>
<span id="cb11-16"><a href="22-mediacloud_to_quanteda.html#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">meta</span>(qd,<span class="st">&quot;project&quot;</span>)<span class="ot">&lt;-</span><span class="st">&quot;ANR-DFG Project IMAGEUN&quot;</span></span></code></pre></div>
<p>We have created a quanteda object with a lot of information stored in various fields. The structure of the object is the following one</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="22-mediacloud_to_quanteda.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(qd)</span></code></pre></div>
<pre><code> &#39;corpus&#39; Named chr [1:12794] &quot;Les tarifs de l&#39;ADSL réduits à partir du 1er janvier 2019&quot; ...
 - attr(*, &quot;names&quot;)= chr [1:12794] &quot;text1&quot; &quot;text2&quot; &quot;text3&quot; &quot;text4&quot; ...
 - attr(*, &quot;docvars&quot;)=&#39;data.frame&#39;: 12794 obs. of  5 variables:
  ..$ docname_: chr [1:12794] &quot;text1&quot; &quot;text2&quot; &quot;text3&quot; &quot;text4&quot; ...
  ..$ docid_  : Factor w/ 12794 levels &quot;text1&quot;,&quot;text2&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
  ..$ segid_  : int [1:12794] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ source  : chr [1:12794] &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; ...
  ..$ date    : Date[1:12794], format: &quot;2019-01-02&quot; &quot;2019-01-02&quot; ...
 - attr(*, &quot;meta&quot;)=List of 3
  ..$ system:List of 6
  .. ..$ package-version:Classes &#39;package_version&#39;, &#39;numeric_version&#39;  hidden list of 1
  .. .. ..$ : int [1:3] 3 0 0
  .. ..$ r-version      :Classes &#39;R_system_version&#39;, &#39;package_version&#39;, &#39;numeric_version&#39;  hidden list of 1
  .. .. ..$ : int [1:3] 4 1 0
  .. ..$ system         : Named chr [1:3] &quot;Windows&quot; &quot;x86-64&quot; &quot;claude&quot;
  .. .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;sysname&quot; &quot;machine&quot; &quot;user&quot;
  .. ..$ directory      : chr &quot;C:/git/media_cookbook&quot;
  .. ..$ created        : Date[1:1], format: &quot;2021-09-30&quot;
  .. ..$ source         : chr &quot;data.frame&quot;
  ..$ object:List of 2
  .. ..$ unit   : chr &quot;documents&quot;
  .. ..$ summary:List of 2
  .. .. ..$ hash: chr(0) 
  .. .. ..$ data: NULL
  ..$ user  :List of 4
  .. ..$ meta_source: chr &quot;Media Cloud &quot;
  .. ..$ meta_time  : chr &quot;Download the 2021-07-13&quot;
  .. ..$ meta_author: chr &quot;Elaborated by Claude Grasland&quot;
  .. ..$ project    : chr &quot;ANR-DFG Project IMAGEUN&quot;</code></pre>
<p>We can look at the first titles with <em>head()</em></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="22-mediacloud_to_quanteda.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(qd,<span class="dv">3</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">text1</td>
<td align="left">Les tarifs de l’ADSL réduits à partir du 1er janvier 2019</td>
</tr>
<tr class="even">
<td align="left">text2</td>
<td align="left">6ème Sfax Marathon International des Oliviers</td>
</tr>
<tr class="odd">
<td align="left">text3</td>
<td align="left">Télécharger la version finale de la Loi de finances 2019</td>
</tr>
</tbody>
</table>
<p>We can get meta information on each stories with <em>summary()</em></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="22-mediacloud_to_quanteda.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">head</span>(qd,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>Corpus consisting of 3 documents, showing 3 documents:

  Text Types Tokens Sentences        source       date
 text1    11     11         1 fr_TUN_ecomag 2019-01-02
 text2     6      6         1 fr_TUN_ecomag 2019-01-02
 text3     8     10         1 fr_TUN_ecomag 2019-01-02</code></pre>
<p>We can get meta information about the full document</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="22-mediacloud_to_quanteda.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">meta</span>(qd)</span></code></pre></div>
<pre><code>$meta_source
[1] &quot;Media Cloud &quot;

$meta_time
[1] &quot;Download the 2021-07-13&quot;

$meta_author
[1] &quot;Elaborated by Claude Grasland&quot;

$project
[1] &quot;ANR-DFG Project IMAGEUN&quot;</code></pre>
<div id="storage-of-the-quanteda-object" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Storage of the quanteda object</h3>
<p>We can finally save the object in .Rdata format in a directory dedicated to our quanteda files. It can be usefull to give some information in the name of the file</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="22-mediacloud_to_quanteda.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(qd,<span class="st">&quot;data/corpora/TUN/fr_TUN_ecomag.Rdata&quot;</span>)</span></code></pre></div>
<p>We have kept all the information present in the initial file, but also added specific metadata of interest for us. The size of the storage is now equal to 0.6 Mb which means a division by 6 as compared to the initial .csv file downloaded from Media Cloud.</p>
</div>
<div id="backtransformation-of-quanteda-to-data.table-or-tibble" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Backtransformation of quanteda to data.table or tibble</h3>
<p>In the following steps, we will make an intensive use of quanteda, but sometimes it can be usefull to export the results in a more practical format or to use other packages. For this reasons, it is important to know that the <code>tidytext</code>package can easily transform quanteda object in tibbles which are more classical and easy to manage</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="22-mediacloud_to_quanteda.html#cb20-1" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tidy</span>(qd)</span>
<span id="cb20-2"><a href="22-mediacloud_to_quanteda.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(td)</span></code></pre></div>
<pre><code># A tibble: 6 x 3
  text                                                     source     date      
  &lt;chr&gt;                                                    &lt;chr&gt;      &lt;date&gt;    
1 Les tarifs de l&#39;ADSL réduits à partir du 1er janvier 20~ fr_TUN_ec~ 2019-01-02
2 6ème Sfax Marathon International des Oliviers            fr_TUN_ec~ 2019-01-02
3 Télécharger la version finale de la Loi de finances 2019 fr_TUN_ec~ 2019-01-02
4 Chawki Tabib : 245 dossiers de corruption présumée tran~ fr_TUN_ec~ 2019-01-02
5 Panoro Energy finalise l&#39;acquisition de OMV Tunisia      fr_TUN_ec~ 2019-01-02
6 La partie syndicale maintient le boycott des examens du~ fr_TUN_ec~ 2019-01-02</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="22-mediacloud_to_quanteda.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(td)</span></code></pre></div>
<pre><code>tibble [12,794 x 3] (S3: tbl_df/tbl/data.frame)
 $ text  : chr [1:12794] &quot;Les tarifs de l&#39;ADSL réduits à partir du 1er janvier 2019&quot; &quot;6ème Sfax Marathon International des Oliviers&quot; &quot;Télécharger la version finale de la Loi de finances 2019&quot; &quot;Chawki Tabib : 245 dossiers de corruption présumée transmis au ministère public&quot; ...
 $ source: chr [1:12794] &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; &quot;fr_TUN_ecomag&quot; ...
 $ date  : Date[1:12794], format: &quot;2019-01-02&quot; &quot;2019-01-02&quot; ...</code></pre>

</div>
</div>
</div>
<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="21-corpus-mediacloud.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="31_geonetworks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ClaudeGrasland/media_cookbook/blob/master/22-mediacloud_to_quanteda.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
