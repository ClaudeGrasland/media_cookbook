# Wikidata {#c23_taggeo}

```{r}
library(knitr)
library(dplyr)
library(WikidataR)
library(quanteda)
```





## Detection of world regions



We have  elaborated a function where the user can decide (optionally) to split some groups and/or to use lower case. 


```{r}
extract_tags <- function(qd = qd,                      # the corpus of interest
                         lang = "fr",                  # the language to be used
                         dict = dict,                  # the dictionary of target entities
                         comps = c("Afrique du sud"),  # compounds
                         split  = c("'","’","-"),       # split list
                         tolow = FALSE                  # Tokenize text
                         )
{ 


  
# Tokenize  
x<-as.character(qd)


if(length(split) > 0) { reg<-paste(split, collapse = '|')
                       x <- gsub(reg," ",x)}  
if(tolow) { x <- tolower(x)} 
toks<-tokens(x)
#toks

toks<-tokens_compound(toks,pattern=phrase(comps))

  
# Load dictionaries and create compounds

  ## Target dictionary
dict<-dict[dict$lang==lang & is.na(dict$label)==F,]
target<-dict[ntoken(dict$label)>1,]
labels <-dict$label
if(length(split) > 0) { reg<-paste(split, collapse = '|')
                       labels<- gsub(reg," ",labels)}  
if(tolow)       {labels <- tolower(labels)}  
toks<-tokens_compound(toks,pattern=phrase(labels))
  
 # create quanteda dictionary
keys <-gsub(" ","_",labels)
qd_dict<-as.list(keys)
names(qd_dict)<-dict$id
qd_dict<-dictionary(qd_dict,tolower = FALSE)

# Identify geo tags (states or reg or org ...)
toks_tags <- tokens_lookup(toks, qd_dict, case_insensitive = F)
toks_tags <- lapply(toks_tags, unique)
toks_tags<-as.tokens(toks_tags)
list_tags<-function(x){res<-paste(x, collapse=' ')}
qd$regs<-as.character(lapply(toks_tags,FUN=list_tags))
qd$nbregs<-ntoken(toks_tags)



# Export results
return(qd)
 }
             
```

### Le Figaro (FRA)

```{r, eval=FALSE}


dict<-read.table("dict/worldreg003bis_dict.csv", header=T, sep=";",encoding="UTF-8")



qd <- readRDS("quanteda/fr_FRA_figaro.RDS")
frcomps<-c("Afrique du Sud", "Afrique du sud","Europe 1", "Atlantic city")

qd <- extract_tags (qd = qd,
                     lang="fr",
                     dict = dict,
                     split = c("'","’","-"),
                     comps = frcomps,
                     tolow = FALSE)
saveRDS(qd,"quanteda/fr_FRA_figaro.RDS")
qd1<-qd

table(qd$nbregs)
x<-data.frame(text=as.character(qd),regs=qd$regs,nbregs=qd$nbregs)

```

### Le Monde

```{r, eval=FALSE}

qd <- readRDS("quanteda/fr_FRA_lmonde.RDS")


qd <- extract_tags (qd = qd,
                     lang="fr",
                     dict = dict,
                    comps = frcomps,                   
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/fr_FRA_lmonde.RDS")
qd2<-qd

table(qd$nbregs)

```

### FAZ

```{r, eval=FALSE}

qd <- readRDS("quanteda/de_DEU_frankf.RDS")

decomps <- c("Europa League")
qd <- extract_tags (qd = qd,
                     lang="de",
                     dict = dict,
                     comps = decomps,
                     split = c("'","’","-"),
                    tolow = FALSE)
saveRDS(qd,"quanteda/de_DEU_frankf.RDS")
qd3<-qd
table(qd$nbregs)

```

### Süddeutsche Zeitung

```{r, eval=FALSE}

qd <- readRDS("quanteda/de_DEU_suddeu.RDS")

qd <- extract_tags (qd = qd,
                     lang="de",
                     dict = dict,
                     comps = decomps,
                     split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/de_DEU_suddeu.RDS")
qd4<-qd
table(qd$nbregs)
```


### Guardian

```{r, eval=FALSE}

qd <- readRDS("quanteda/en_GBR_guardi.RDS")

encomps<-c("Atlantic City", "Cathay Pacific")

qd <- extract_tags (qd = qd,
                     lang="en",
                     dict = dict,
                     comps = encomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/en_GBR_guardi.RDS")
qd5<-qd
table(qd$nbregs)
```

### Daily Telegraph

```{r, eval=FALSE}

qd <- readRDS("quanteda/en_GBR_telegr.RDS")
qd <- extract_tags (qd = qd,
                     lang="en",
                     dict = dict,
                     comps = encomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/en_GBR_telegr.RDS")
qd6<-qd
table(qd$nbregs)
```

### Belfast Telegraph

```{r, eval=FALSE}

qd <- readRDS("quanteda/en_NIR_beltel.RDS")
qd <- extract_tags (qd = qd,
                     lang="en",
                     dict = dict,
                     comps = encomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/en_NIR_beltel.RDS")
qd7<-qd
table(qd$nbregs)
```

### Irish Times

```{r, eval=FALSE}

qd <- readRDS("quanteda/en_IRL_irtime.RDS")
qd <- extract_tags (qd = qd,
                     lang="en",
                     dict = dict,
                     comps = encomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/en_IRL_irtime.RDS")
qd8<-qd
table(qd$nbregs)
```

### Cumhuryet

```{r, eval=FALSE}

qd <- readRDS("quanteda/tr_TUR_cumhur.RDS")

trcomps <- c("Cathay Pacific")

qd <- extract_tags (qd = qd,
                     lang="tr",
                     dict = dict,
                     comps = trcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/tr_TUR_cumhur.RDS")
qd9<-qd
table(qd$nbregs)
```

### Yeni Safak

```{r, eval=FALSE}

qd <- readRDS("quanteda/tr_TUR_yenisa.RDS")
qd <- extract_tags (qd = qd,
                     lang="tr",
                     dict = dict,
                     comps = trcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/tr_TUR_yenisa.RDS")
qd10<-qd
table(qd$nbregs)
```

### Babnet

```{r, eval=FALSE}

qd <- readRDS("quanteda/ar_TUN_babnet.RDS")

arcomps <- c("Cathay Pacific")
qd <- extract_tags (qd = qd,
                     lang="ar",
                     dict = dict,
                     comps = arcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/ar_TUN_babnet.RDS")
qd11<-qd
table(qd$nbregs)
```

### Réalités

```{r, eval=FALSE}

qd <- readRDS("quanteda/fr_TUN_realit.RDS")
qd <- extract_tags (qd = qd,
                     lang="fr",
                     dict = dict,
                     comps = frcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/fr_TUN_realit.RDS")
qd12<-qd
table(qd$nbregs)
```

### Economiste Maghrebin

```{r, eval=FALSE}

qd <- readRDS("quanteda/fr_TUN_ecomag.RDS")
qd <- extract_tags (qd = qd,
                     lang="fr",
                     dict = dict,
                     comps = frcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/fr_TUN_ecomag.RDS")
qd13<-qd
table(qd$nbregs)
```

### La Presse

```{r, eval=FALSE}

qd <- readRDS("quanteda/fr_TUN_presse.RDS")
qd <- extract_tags (qd = qd,
                     lang="fr",
                     dict = dict,
                     comps = frcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/fr_TUN_presse.RDS")
qd14<-qd
table(qd$nbregs)
```


### Al Nahar (DZA)

```{r, eval=FALSE}

qd <- readRDS("quanteda/ar_DZA_alnaha.RDS")
qd <- extract_tags (qd = qd,
                     lang="ar",
                     dict = dict,
                     comps = arcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/ar_DZA_alnaha.RDS")
qd15<-qd
table(qd$nbregs)
```

### El Khabar (DZA)

```{r, eval=FALSE}

qd <- readRDS("quanteda/ar_DZA_elkahb.RDS")
qd <- extract_tags (qd = qd,
                     lang="ar",
                     dict = dict,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/ar_DZA_elkahb.RDS")
qd16<-qd
table(qd$nbregs)
```


### El Watan (DZA)

```{r, eval=FALSE}

qd <- readRDS("quanteda/fr_DZA_elwata.RDS")
qd <- extract_tags (qd = qd,
                     lang="fr",
                     dict = dict,
                     comps = frcomps,
                   split = c("'","’","-"),
                     tolow = FALSE)
saveRDS(qd,"quanteda/fr_DZA_elwata.RDS")
qd17<-qd
table(qd$nbregs)
```

















### Global corpus

```{r, eval=FALSE}
qd <- c(qd1,qd2,qd3,qd4,qd5,qd6,qd7,qd8,qd9,qd10,qd11,qd12,qd13,qd14,qd15,qd16,qd17)
saveRDS(qd,"quanteda/corpus_worldreg_004.RDS")
table(qd$nbregs)
```

